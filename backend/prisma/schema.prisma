generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ============================================================
// ENUMS
// ============================================================

enum UserRole {
  ADMIN
  CUSTOMER
}

enum ApiKeyType {
  STORE
  ADMIN
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum PriceListType {
  SALE
  OVERRIDE
}

enum PriceListStatus {
  ACTIVE
  DRAFT
}

enum PromotionType {
  PERCENTAGE
  FIXED
  FREE_SHIPPING
  BUY_X_GET_Y
}

enum PromotionConditionType {
  MIN_ORDER_AMOUNT
  SPECIFIC_PRODUCTS
  SPECIFIC_CATEGORIES
  CUSTOMER_GROUP
  MIN_QUANTITY
}

enum SalesChannelType {
  WEB
  MOBILE
  POS
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  NOT_PAID
  AWAITING
  CAPTURED
  PARTIALLY_REFUNDED
  REFUNDED
}

enum FulfillmentStatus {
  NOT_FULFILLED
  PARTIALLY_FULFILLED
  FULFILLED
  SHIPPED
  DELIVERED
  RETURNED
}

enum PaymentRecordStatus {
  PENDING
  REQUIRES_ACTION
  CAPTURED
  CANCELED
  FAILED
}

// ============================================================
// USER ACCESS DOMAIN
// ============================================================

model User {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String    @map("password_hash")
  firstName    String    @map("first_name")
  lastName     String    @map("last_name")
  role         UserRole  @default(CUSTOMER)
  isActive     Boolean   @default(true) @map("is_active")
  lastLoginAt  DateTime? @map("last_login_at")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  deletedAt    DateTime? @map("deleted_at")

  customer      Customer?
  refreshTokens RefreshToken[]
  apiKeys       ApiKey[]

  @@map("users")
}

model RefreshToken {
  id        String    @id @default(uuid())
  token     String    @unique
  userId    String    @map("user_id")
  expiresAt DateTime  @map("expires_at")
  revokedAt DateTime? @map("revoked_at")
  createdAt DateTime  @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("refresh_tokens")
}

model ApiKey {
  id         String     @id @default(uuid())
  name       String
  keyHash    String     @unique @map("key_hash")
  keyPrefix  String     @map("key_prefix")
  type       ApiKeyType
  userId     String     @map("user_id")
  lastUsedAt DateTime?  @map("last_used_at")
  expiresAt  DateTime?  @map("expires_at")
  revokedAt  DateTime?  @map("revoked_at")
  createdAt  DateTime   @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([keyHash])
  @@map("api_keys")
}

model Customer {
  id              String    @id @default(uuid())
  userId          String    @unique @map("user_id")
  phone           String?
  customerGroupId String?   @map("customer_group_id")
  metadata        Json?
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  customerGroup CustomerGroup? @relation(fields: [customerGroupId], references: [id])
  addresses     Address[]
  carts         Cart[]
  orders        Order[]

  @@index([customerGroupId])
  @@map("customers")
}

model CustomerGroup {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  metadata    Json?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  customers      Customer[]
  priceListLinks CustomerGroupPriceList[]

  @@map("customer_groups")
}

model Address {
  id           String   @id @default(uuid())
  customerId   String   @map("customer_id")
  label        String?
  firstName    String   @map("first_name")
  lastName     String   @map("last_name")
  addressLine1 String   @map("address_line_1")
  addressLine2 String?  @map("address_line_2")
  city         String
  state        String?
  postalCode   String   @map("postal_code")
  countryCode  String   @map("country_code")
  phone        String?
  isDefault    Boolean  @default(false) @map("is_default")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@map("addresses")
}

// ============================================================
// PRODUCT & MERCHANDISING DOMAIN
// ============================================================

model Product {
  id          String        @id @default(uuid())
  title       String
  slug        String        @unique
  description String?
  handle      String?       @unique
  status      ProductStatus @default(DRAFT)
  isGiftCard  Boolean       @default(false) @map("is_gift_card")
  metadata    Json?
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  deletedAt   DateTime?     @map("deleted_at")

  variants      ProductVariant[]
  images        ProductImage[]
  categories    ProductCategory[]
  salesChannels ProductSalesChannel[]
  tags          ProductTag[]

  @@map("products")
}

model ProductVariant {
  id              String    @id @default(uuid())
  productId       String    @map("product_id")
  title           String
  sku             String?   @unique
  barcode         String?
  price           Decimal   @db.Decimal(12, 4)
  compareAtPrice  Decimal?  @map("compare_at_price") @db.Decimal(12, 4)
  costPrice       Decimal?  @map("cost_price") @db.Decimal(12, 4)
  weight          Decimal?  @db.Decimal(10, 2)
  weightUnit      String?   @default("kg") @map("weight_unit")
  position        Int       @default(0)
  manageInventory Boolean   @default(true) @map("manage_inventory")
  metadata        Json?
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")

  product         Product              @relation(fields: [productId], references: [id], onDelete: Cascade)
  optionValues    VariantOptionValue[]
  inventoryLevels InventoryLevel[]
  cartItems       CartItem[]
  orderItems      OrderItem[]
  priceListPrices PriceListPrice[]

  @@index([productId])
  @@map("product_variants")
}

model ProductOption {
  id        String   @id @default(uuid())
  name      String   @unique
  position  Int      @default(0)
  createdAt DateTime @default(now()) @map("created_at")

  values ProductOptionValue[]

  @@map("product_options")
}

model ProductOptionValue {
  id       String @id @default(uuid())
  optionId String @map("option_id")
  value    String
  position Int    @default(0)

  option       ProductOption        @relation(fields: [optionId], references: [id], onDelete: Cascade)
  variantLinks VariantOptionValue[]

  @@unique([optionId, value])
  @@map("product_option_values")
}

model VariantOptionValue {
  variantId     String @map("variant_id")
  optionValueId String @map("option_value_id")

  variant     ProductVariant     @relation(fields: [variantId], references: [id], onDelete: Cascade)
  optionValue ProductOptionValue @relation(fields: [optionValueId], references: [id], onDelete: Cascade)

  @@id([variantId, optionValueId])
  @@map("variant_option_values")
}

model ProductImage {
  id        String   @id @default(uuid())
  productId String   @map("product_id")
  url       String
  altText   String?  @map("alt_text")
  position  Int      @default(0)
  createdAt DateTime @default(now()) @map("created_at")

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_images")
}

model Category {
  id          String    @id @default(uuid())
  name        String
  slug        String    @unique
  description String?
  parentId    String?   @map("parent_id")
  position    Int       @default(0)
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  parent   Category?         @relation("CategoryTree", fields: [parentId], references: [id])
  children Category[]        @relation("CategoryTree")
  products ProductCategory[]

  @@index([parentId])
  @@map("categories")
}

model ProductCategory {
  productId  String @map("product_id")
  categoryId String @map("category_id")

  product  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@id([productId, categoryId])
  @@map("product_categories")
}

model Tag {
  id       String       @id @default(uuid())
  name     String       @unique
  products ProductTag[]

  @@map("tags")
}

model ProductTag {
  productId String @map("product_id")
  tagId     String @map("tag_id")

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([productId, tagId])
  @@map("product_tags")
}

// ============================================================
// PRICING DOMAIN
// ============================================================

model PriceList {
  id          String          @id @default(uuid())
  name        String
  description String?
  type        PriceListType   @default(SALE)
  status      PriceListStatus @default(ACTIVE)
  startsAt    DateTime?       @map("starts_at")
  endsAt      DateTime?       @map("ends_at")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  deletedAt   DateTime?       @map("deleted_at")

  prices         PriceListPrice[]
  customerGroups CustomerGroupPriceList[]

  @@map("price_lists")
}

model PriceListPrice {
  id           String   @id @default(uuid())
  priceListId  String   @map("price_list_id")
  variantId    String   @map("variant_id")
  currencyCode String   @map("currency_code")
  amount       Decimal  @db.Decimal(12, 4)
  minQuantity  Int      @default(1) @map("min_quantity")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  priceList PriceList      @relation(fields: [priceListId], references: [id], onDelete: Cascade)
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  currency  Currency       @relation(fields: [currencyCode], references: [code])

  @@unique([priceListId, variantId, currencyCode, minQuantity])
  @@map("price_list_prices")
}

model CustomerGroupPriceList {
  customerGroupId String @map("customer_group_id")
  priceListId     String @map("price_list_id")

  customerGroup CustomerGroup @relation(fields: [customerGroupId], references: [id], onDelete: Cascade)
  priceList     PriceList     @relation(fields: [priceListId], references: [id], onDelete: Cascade)

  @@id([customerGroupId, priceListId])
  @@map("customer_group_price_lists")
}

// ============================================================
// PROMOTIONS DOMAIN
// ============================================================

model Promotion {
  id               String        @id @default(uuid())
  code             String?       @unique
  name             String
  description      String?
  type             PromotionType
  value            Decimal       @db.Decimal(12, 4)
  currencyCode     String?       @map("currency_code")
  usageLimit       Int?          @map("usage_limit")
  usageCount       Int           @default(0) @map("usage_count")
  perCustomerLimit Int?          @map("per_customer_limit")
  minOrderAmount   Decimal?      @map("min_order_amount") @db.Decimal(12, 4)
  isAutomatic      Boolean       @default(false) @map("is_automatic")
  isActive         Boolean       @default(true) @map("is_active")
  startsAt         DateTime      @map("starts_at")
  endsAt           DateTime?     @map("ends_at")
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  deletedAt        DateTime?     @map("deleted_at")

  conditions PromotionCondition[]
  usages     PromotionUsage[]

  @@map("promotions")
}

model PromotionCondition {
  id          String                 @id @default(uuid())
  promotionId String                 @map("promotion_id")
  type        PromotionConditionType
  operator    String
  value       Json
  createdAt   DateTime               @default(now()) @map("created_at")

  promotion Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)

  @@map("promotion_conditions")
}

model PromotionUsage {
  id          String   @id @default(uuid())
  promotionId String   @map("promotion_id")
  customerId  String   @map("customer_id")
  orderId     String   @map("order_id")
  createdAt   DateTime @default(now()) @map("created_at")

  promotion Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)

  @@index([promotionId, customerId])
  @@map("promotion_usages")
}

// ============================================================
// REGIONS, CURRENCY, TAX DOMAIN
// ============================================================

model Region {
  id                  String    @id @default(uuid())
  name                String    @unique
  currencyCode        String    @map("currency_code")
  taxInclusivePricing Boolean   @default(false) @map("tax_inclusive_pricing")
  metadata            Json?
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  deletedAt           DateTime? @map("deleted_at")

  currency        Currency         @relation(fields: [currencyCode], references: [code])
  countries       RegionCountry[]
  taxRates        TaxRate[]
  shippingMethods ShippingMethod[]

  @@map("regions")
}

model RegionCountry {
  regionId    String @map("region_id")
  countryCode String @map("country_code")

  region Region @relation(fields: [regionId], references: [id], onDelete: Cascade)

  @@id([regionId, countryCode])
  @@map("region_countries")
}

model Currency {
  code          String   @id
  name          String
  symbol        String
  symbolNative  String   @map("symbol_native")
  decimalDigits Int      @default(2) @map("decimal_digits")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  exchangeRatesFrom ExchangeRate[]   @relation("FromCurrency")
  exchangeRatesTo   ExchangeRate[]   @relation("ToCurrency")
  regions           Region[]
  priceListPrices   PriceListPrice[]

  @@map("currencies")
}

model ExchangeRate {
  id           String   @id @default(uuid())
  fromCurrency String   @map("from_currency")
  toCurrency   String   @map("to_currency")
  rate         Decimal  @db.Decimal(18, 8)
  updatedAt    DateTime @updatedAt @map("updated_at")

  from Currency @relation("FromCurrency", fields: [fromCurrency], references: [code])
  to   Currency @relation("ToCurrency", fields: [toCurrency], references: [code])

  @@unique([fromCurrency, toCurrency])
  @@map("exchange_rates")
}

model TaxRate {
  id        String   @id @default(uuid())
  regionId  String   @map("region_id")
  name      String
  rate      Decimal  @db.Decimal(5, 4)
  code      String?
  isDefault Boolean  @default(false) @map("is_default")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  region Region @relation(fields: [regionId], references: [id], onDelete: Cascade)

  @@index([regionId])
  @@map("tax_rates")
}

// ============================================================
// SALES CHANNELS DOMAIN
// ============================================================

model SalesChannel {
  id          String           @id @default(uuid())
  name        String           @unique
  description String?
  type        SalesChannelType @default(WEB)
  isActive    Boolean          @default(true) @map("is_active")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  deletedAt   DateTime?        @map("deleted_at")

  products ProductSalesChannel[]
  orders   Order[]

  @@map("sales_channels")
}

model ProductSalesChannel {
  productId      String @map("product_id")
  salesChannelId String @map("sales_channel_id")

  product      Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  salesChannel SalesChannel @relation(fields: [salesChannelId], references: [id], onDelete: Cascade)

  @@id([productId, salesChannelId])
  @@map("product_sales_channels")
}

// ============================================================
// INVENTORY DOMAIN
// ============================================================

model StockLocation {
  id           String    @id @default(uuid())
  name         String
  code         String    @unique
  addressLine1 String?   @map("address_line_1")
  addressLine2 String?   @map("address_line_2")
  city         String?
  state        String?
  postalCode   String?   @map("postal_code")
  countryCode  String?   @map("country_code")
  isActive     Boolean   @default(true) @map("is_active")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  deletedAt    DateTime? @map("deleted_at")

  inventoryLevels InventoryLevel[]
  fulfillments    Fulfillment[]

  @@map("stock_locations")
}

model InventoryLevel {
  id                String   @id @default(uuid())
  variantId         String   @map("variant_id")
  stockLocationId   String   @map("stock_location_id")
  onHand            Int      @default(0) @map("on_hand")
  reserved          Int      @default(0)
  available         Int      @default(0)
  lowStockThreshold Int?     @map("low_stock_threshold")
  updatedAt         DateTime @updatedAt @map("updated_at")

  variant       ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  stockLocation StockLocation  @relation(fields: [stockLocationId], references: [id], onDelete: Cascade)

  @@unique([variantId, stockLocationId])
  @@map("inventory_levels")
}

model StockReservation {
  id              String    @id @default(uuid())
  variantId       String    @map("variant_id")
  stockLocationId String    @map("stock_location_id")
  orderId         String?   @map("order_id")
  quantity        Int
  expiresAt       DateTime  @map("expires_at")
  releasedAt      DateTime? @map("released_at")
  createdAt       DateTime  @default(now()) @map("created_at")

  @@index([variantId, stockLocationId])
  @@index([expiresAt])
  @@map("stock_reservations")
}

// ============================================================
// CART & CHECKOUT DOMAIN
// ============================================================

model Cart {
  id                String    @id @default(uuid())
  customerId        String?   @map("customer_id")
  regionId          String?   @map("region_id")
  salesChannelId    String?   @map("sales_channel_id")
  email             String?
  currencyCode      String    @default("USD") @map("currency_code")
  discountCode      String?   @map("discount_code")
  subtotal          Decimal   @default(0) @db.Decimal(12, 4)
  taxTotal          Decimal   @default(0) @map("tax_total") @db.Decimal(12, 4)
  shippingTotal     Decimal   @default(0) @map("shipping_total") @db.Decimal(12, 4)
  discountTotal     Decimal   @default(0) @map("discount_total") @db.Decimal(12, 4)
  total             Decimal   @default(0) @db.Decimal(12, 4)
  shippingAddressId String?   @map("shipping_address_id")
  billingAddressId  String?   @map("billing_address_id")
  completedAt       DateTime? @map("completed_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  customer Customer?  @relation(fields: [customerId], references: [id])
  items    CartItem[]

  @@index([customerId])
  @@map("carts")
}

model CartItem {
  id        String   @id @default(uuid())
  cartId    String   @map("cart_id")
  variantId String   @map("variant_id")
  quantity  Int      @default(1)
  unitPrice Decimal  @map("unit_price") @db.Decimal(12, 4)
  total     Decimal  @db.Decimal(12, 4)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cart    Cart           @relation(fields: [cartId], references: [id], onDelete: Cascade)
  variant ProductVariant @relation(fields: [variantId], references: [id])

  @@unique([cartId, variantId])
  @@map("cart_items")
}

// ============================================================
// ORDER & FULFILLMENT DOMAIN
// ============================================================

model Order {
  id                String            @id @default(uuid())
  displayId         Int               @unique @default(autoincrement()) @map("display_id")
  customerId        String            @map("customer_id")
  salesChannelId    String?           @map("sales_channel_id")
  regionId          String?           @map("region_id")
  currencyCode      String            @map("currency_code")
  status            OrderStatus       @default(PENDING)
  paymentStatus     PaymentStatus     @default(NOT_PAID) @map("payment_status")
  fulfillmentStatus FulfillmentStatus @default(NOT_FULFILLED) @map("fulfillment_status")
  email             String
  subtotal          Decimal           @db.Decimal(12, 4)
  taxTotal          Decimal           @map("tax_total") @db.Decimal(12, 4)
  shippingTotal     Decimal           @map("shipping_total") @db.Decimal(12, 4)
  discountTotal     Decimal           @map("discount_total") @db.Decimal(12, 4)
  total             Decimal           @db.Decimal(12, 4)
  shippingAddress   Json              @map("shipping_address")
  billingAddress    Json?             @map("billing_address")
  metadata          Json?
  canceledAt        DateTime?         @map("canceled_at")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")

  customer     Customer      @relation(fields: [customerId], references: [id])
  salesChannel SalesChannel? @relation(fields: [salesChannelId], references: [id])
  items        OrderItem[]
  payments     Payment[]
  fulfillments Fulfillment[]
  notes        OrderNote[]

  @@index([customerId])
  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

model OrderItem {
  id             String   @id @default(uuid())
  orderId        String   @map("order_id")
  variantId      String   @map("variant_id")
  title          String
  variantTitle   String   @map("variant_title")
  sku            String?
  quantity       Int
  unitPrice      Decimal  @map("unit_price") @db.Decimal(12, 4)
  taxRate        Decimal  @map("tax_rate") @db.Decimal(5, 4)
  taxAmount      Decimal  @map("tax_amount") @db.Decimal(12, 4)
  discountAmount Decimal  @default(0) @map("discount_amount") @db.Decimal(12, 4)
  total          Decimal  @db.Decimal(12, 4)
  metadata       Json?
  createdAt      DateTime @default(now()) @map("created_at")

  order   Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  variant ProductVariant @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@map("order_items")
}

model OrderNote {
  id        String   @id @default(uuid())
  orderId   String   @map("order_id")
  authorId  String?  @map("author_id")
  content   String
  isPrivate Boolean  @default(true) @map("is_private")
  createdAt DateTime @default(now()) @map("created_at")

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@map("order_notes")
}

model Payment {
  id           String              @id @default(uuid())
  orderId      String              @map("order_id")
  provider     String              @default("stripe")
  externalId   String?             @unique @map("external_id")
  amount       Decimal             @db.Decimal(12, 4)
  currencyCode String              @map("currency_code")
  status       PaymentRecordStatus @default(PENDING)
  capturedAt   DateTime?           @map("captured_at")
  canceledAt   DateTime?           @map("canceled_at")
  metadata     Json?
  createdAt    DateTime            @default(now()) @map("created_at")
  updatedAt    DateTime            @updatedAt @map("updated_at")

  order   Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  refunds Refund[]

  @@index([orderId])
  @@index([externalId])
  @@map("payments")
}

model Refund {
  id         String   @id @default(uuid())
  paymentId  String   @map("payment_id")
  externalId String?  @unique @map("external_id")
  amount     Decimal  @db.Decimal(12, 4)
  reason     String?
  createdAt  DateTime @default(now()) @map("created_at")

  payment Payment @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@index([paymentId])
  @@map("refunds")
}

model Fulfillment {
  id               String    @id @default(uuid())
  orderId          String    @map("order_id")
  stockLocationId  String    @map("stock_location_id")
  shippingMethodId String?   @map("shipping_method_id")
  trackingNumber   String?   @map("tracking_number")
  trackingUrl      String?   @map("tracking_url")
  shippedAt        DateTime? @map("shipped_at")
  deliveredAt      DateTime? @map("delivered_at")
  canceledAt       DateTime? @map("canceled_at")
  metadata         Json?
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")

  order          Order             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  stockLocation  StockLocation     @relation(fields: [stockLocationId], references: [id])
  shippingMethod ShippingMethod?   @relation(fields: [shippingMethodId], references: [id])
  items          FulfillmentItem[]

  @@index([orderId])
  @@map("fulfillments")
}

model FulfillmentItem {
  id            String @id @default(uuid())
  fulfillmentId String @map("fulfillment_id")
  orderItemId   String @map("order_item_id")
  quantity      Int

  fulfillment Fulfillment @relation(fields: [fulfillmentId], references: [id], onDelete: Cascade)

  @@index([fulfillmentId])
  @@map("fulfillment_items")
}

model ShippingMethod {
  id             String   @id @default(uuid())
  regionId       String   @map("region_id")
  name           String
  price          Decimal  @db.Decimal(12, 4)
  minOrderAmount Decimal? @map("min_order_amount") @db.Decimal(12, 4)
  maxOrderAmount Decimal? @map("max_order_amount") @db.Decimal(12, 4)
  isActive       Boolean  @default(true) @map("is_active")
  metadata       Json?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  region       Region        @relation(fields: [regionId], references: [id], onDelete: Cascade)
  fulfillments Fulfillment[]

  @@index([regionId])
  @@map("shipping_methods")
}
